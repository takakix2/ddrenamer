# DDRenamer (Tauri-Rust Edition) 実装要件定義書

PC破壊により失われた前作の記憶を、Rustの堅牢性とTauriの軽量さで再構築するための実装記録です。

---

## 1. プロジェクト概要

- **コンセプト**: 「迷わない、広い、速い」。タブで機能を選択し、巨大なドロップゾーンに投げ込むだけでリネームを完結させる。
- **コア技術**:
  - **Frontend**: Tauri v2, React (Vite), Tailwind CSS, Lucide-react (Icon)
  - **Backend**: Rust (std::fs, PathBuf, Regex)

---

## 2. 実装済み機能ステータス

| 機能 | ステータス | 詳細 |
| :--- | :--- | :--- |
| **定型リネーム** | ✅ 完了 | 拡張子維持/破棄の選択可能 |
| **連番リネーム** | ✅ 完了 | 接頭辞/接尾辞、桁数指定、**元の名前の保持**可能 |
| **手動連番** | ✅ 完了 | `Manual Increment` モードで1ドロップ毎のカウンタ管理 |
| **文字列置換** | ✅ 完了 | **正規表現 (Regex)** による一括置換対応 |
| **追加/削除** | ✅ 完了 | 指定位置（先頭/末尾）への追加および文字数指定削除 |
| **ケース変換** | ✅ 完了 | 大文字/小文字変換。**拡張子保護機能**付き |
| **全角/半角変換** | ✅ 完了 | ASCII ↔ 全角英数の高速マッピング。**拡張子保護機能**付き |
| **拡張子変更** | ✅ 完了 | ドットの有無を問わない安全な拡張子置換 |
| **実行ログ** | ✅ 完了 | 下部へのスライドアニメーション付きログリスト（一意ID管理） |
| **UXフィードバック**| ✅ 完了 | ドラッグオーバー時のビジュアル強調 |

---

## 3. システム設計 (Architecture)

### Backend (`src-tauri/src/lib.rs`)
- `Position`, `CaseMode`, `WidthMode` などの **Enum 定義**により、型安全なリネームコマンドを実現。
- `join_name_ext` ヘルパーにより、全てのモードで「ファイル名本体」と「拡張子」を分離して処理。
- `fs::rename` の実行前に `new_path.exists()` チェックを行い、ファイル上書き事故を防止。

### Frontend (`src/App.tsx`)
- **Tauri v2 API** (`getCurrentWebview().onDragDropEvent`) を活用したネイティブなイベント処理。
- `configRef` パターンによる、クロージャ内での最新ステートの参照。
- タイムスタンプベースのユニークIDによる安定したログレンダリング。

---

## 4. 今後の拡張 (Pending)

- [ ] **名前の交換 (Swap)**: 2つのファイル名を入れ替えるロジックの追加（一時ファイル経由の3段階リネーム）。
- [ ] **Undo 機能**: リネーム履歴をスタックし、逆方向の `rename` を実行。
- [ ] **サウンド通知**: 完了時の SE 再生。
- [ ] **多重拡張子対応**: `.tar.gz` などの正確なパース。

---

## 5. 開発者向けメモ

### Linux (Wayland) 環境での制約
Wayland プロトコル環境では、OS側の制限によりファイルマネージャーからの D&D イベントがアプリに届かない場合があります。開発時は X11 指定での起動や、他プラットフォームでの検証を推奨。

---
*Last Updated: 2026-02-16*
*Source concept: http://nu.way-nifty.com/top/ddrhelp.html*
